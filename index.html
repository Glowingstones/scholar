<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç§‘ç ”æˆæœç®¡ç†ç³»ç»Ÿ (æ——èˆ°å®Œæ•´ç‰ˆ)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* =================================================================
           1. æ ·å¼ç³»ç»Ÿ (CSS Design System)
           ================================================================= */
        :root {
            --bg-body: #f1f5f9;
            --bg-sidebar: #ffffff;
            --bg-card: #ffffff;
            --bg-hover: #f8fafc;
            --bg-active: #eff6ff;
            
            --text-main: #0f172a;
            --text-sub: #64748b;
            --text-muted: #94a3b8;
            --text-white: #ffffff;

            --primary: #4f46e5;
            --primary-hover: #4338ca;
            --primary-light: #eef2ff;

            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;

            --border: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --radius: 10px;
        }

        /* æš—è‰²æ¨¡å¼ */
        @media (prefers-color-scheme: dark) {
            :root {
                --bg-body: #0f172a;
                --bg-sidebar: #1e293b;
                --bg-card: #1e293b;
                --bg-hover: #334155;
                --bg-active: #312e81;
                
                --text-main: #f8fafc;
                --text-sub: #cbd5e1;
                --text-muted: #64748b;
                
                --border: #334155;
            }
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            display: flex;
        }

        /* =================================================================
           2. ä¾§è¾¹æ å¸ƒå±€ (Sidebar Layout)
           ================================================================= */
        .sidebar {
            width: 260px;
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            z-index: 50;
            transition: transform 0.3s ease;
        }

        .sidebar-header {
            padding: 24px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .app-logo {
            width: 40px; height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--primary-hover));
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 1.5rem;
            box-shadow: var(--shadow);
        }

        .app-title { font-size: 1.1rem; font-weight: 700; color: var(--text-main); }

        .nav-container { flex: 1; overflow-y: auto; padding: 20px 12px; }

        .nav-group { margin-bottom: 24px; }
        .nav-label {
            font-size: 0.75rem; color: var(--text-muted); font-weight: 600;
            text-transform: uppercase; padding-left: 12px; margin-bottom: 8px;
        }

        .nav-item {
            display: flex; align-items: center; padding: 12px;
            border-radius: var(--radius); cursor: pointer;
            color: var(--text-sub); transition: all 0.2s;
            margin-bottom: 4px;
        }
        .nav-item:hover { background: var(--bg-hover); color: var(--text-main); }
        .nav-item.active { background: var(--bg-active); color: var(--primary); font-weight: 600; }
        
        .nav-icon { width: 24px; text-align: center; margin-right: 12px; font-size: 1.1rem; }
        .nav-count {
            margin-left: auto; background: var(--bg-hover);
            padding: 2px 8px; border-radius: 12px; font-size: 0.75rem;
        }

        .sidebar-footer {
            padding: 16px; border-top: 1px solid var(--border);
            background: var(--bg-sidebar); position: relative;
        }

        .storage-indicator {
            display: flex; align-items: center; gap: 8px;
            font-size: 0.8rem; color: var(--success); margin-bottom: 12px;
            padding: 8px; background: var(--bg-hover); border-radius: var(--radius);
        }
        .indicator-dot { width: 8px; height: 8px; background: var(--success); border-radius: 50%; }

        .action-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        
        .btn-sidebar {
            padding: 10px; border: 1px solid var(--border); border-radius: var(--radius);
            background: var(--bg-card); color: var(--text-sub); font-size: 0.85rem;
            cursor: pointer; text-align: center; transition: all 0.2s;
        }
        .btn-sidebar:hover { border-color: var(--primary); color: var(--primary); }

        /* å¼¹å‡ºèœå• */
        .popup-menu {
            position: absolute; bottom: 100%; left: 10px; right: 10px;
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: var(--radius); box-shadow: var(--shadow-lg);
            display: none; flex-direction: column; overflow: hidden;
            margin-bottom: 10px; z-index: 100;
        }
        .popup-menu.show { display: flex; animation: slideUp 0.2s; }
        .menu-option {
            padding: 12px 16px; cursor: pointer; display: flex; align-items: center; gap: 10px;
            border-bottom: 1px solid var(--border); font-size: 0.9rem; color: var(--text-main);
        }
        .menu-option:hover { background: var(--bg-hover); color: var(--primary); }
        .menu-option:last-child { border-bottom: none; }

        @keyframes slideUp { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }

        /* =================================================================
           3. ä¸»ç•Œé¢å¸ƒå±€ (Main Layout)
           ================================================================= */
        .main-wrapper { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        
        .top-bar {
            height: 70px; padding: 0 32px;
            display: flex; align-items: center; justify-content: space-between;
            background: var(--bg-body); flex-shrink: 0;
        }
        .page-title h1 { font-size: 1.5rem; font-weight: 700; color: var(--text-main); }
        
        .top-actions { display: flex; align-items: center; gap: 16px; }
        .search-wrap { position: relative; }
        .search-input {
            width: 280px; padding: 10px 16px 10px 36px;
            border: 1px solid var(--border); border-radius: var(--radius);
            background: var(--bg-card); color: var(--text-main);
        }
        .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); opacity: 0.5; }

        .btn-primary {
            background: var(--primary); color: white; border: none;
            padding: 10px 20px; border-radius: var(--radius); font-weight: 600;
            cursor: pointer; display: flex; align-items: center; gap: 8px;
            box-shadow: var(--shadow); transition: background 0.2s;
        }
        .btn-primary:hover { background: var(--primary-hover); }

        .content-scroll { flex: 1; overflow-y: auto; padding: 0 32px 32px; }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-row { 
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; margin-bottom: 24px;
        }
        .stat-box {
            background: var(--bg-card); padding: 20px; border-radius: var(--radius);
            border: 1px solid var(--border); display: flex; align-items: center; gap: 16px;
            box-shadow: var(--shadow-sm); transition: transform 0.2s;
        }
        .stat-box:hover { transform: translateY(-2px); }
        .stat-icon {
            width: 48px; height: 48px; border-radius: 12px;
            display: flex; align-items: center; justify-content: center; font-size: 1.5rem;
        }
        .stat-info h3 { font-size: 1.5rem; font-weight: 700; line-height: 1; margin-bottom: 4px; }
        .stat-info p { font-size: 0.85rem; color: var(--text-sub); }

        /* åˆ—è¡¨åŒºåŸŸ */
        .list-panel {
            background: var(--bg-card); border: 1px solid var(--border);
            border-radius: var(--radius); overflow: hidden; display: flex; flex-direction: column;
            min-height: 400px;
        }
        .list-toolbar {
            padding: 16px 24px; border-bottom: 1px solid var(--border);
            background: var(--bg-hover); display: flex; justify-content: space-between; align-items: center;
        }
        .batch-ops { display: flex; align-items: center; gap: 12px; font-size: 0.9rem; color: var(--text-sub); }
        .btn-danger { background: var(--danger); color: white; padding: 6px 12px; border-radius: 6px; font-size: 0.8rem; display: none; }
        
        .list-body { flex: 1; overflow-y: auto; }
        
        .list-row {
            padding: 16px 24px; border-bottom: 1px solid var(--border);
            display: flex; align-items: center; gap: 20px; cursor: pointer;
            transition: background 0.1s;
        }
        .list-row:hover { background: var(--bg-hover); }
        .list-row:last-child { border-bottom: none; }
        
        .row-check { width: 18px; height: 18px; cursor: pointer; accent-color: var(--primary); }
        .row-icon {
            width: 40px; height: 40px; border-radius: 8px; flex-shrink: 0;
            display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
        }
        .type-paper { background: #e0f2fe; color: #0369a1; }
        .type-patent { background: #fef3c7; color: #b45309; }
        .type-project { background: #dcfce7; color: #15803d; }
        .type-award { background: #fee2e2; color: #b91c1c; }
        .type-book { background: #f3e8ff; color: #7e22ce; }
        .type-member { background: #ffedd5; color: #c2410c; }

        .row-content { flex: 1; min-width: 0; }
        .row-title { font-weight: 600; color: var(--text-main); font-size: 1rem; margin-bottom: 4px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .row-meta { display: flex; gap: 16px; font-size: 0.85rem; color: var(--text-sub); }
        .meta-tag { display: flex; align-items: center; gap: 4px; }
        .has-file { color: var(--primary); font-weight: 500; }

        .row-actions { display: flex; gap: 8px; opacity: 0; transition: opacity 0.2s; }
        .list-row:hover .row-actions { opacity: 1; }
        .icon-btn {
            width: 32px; height: 32px; border-radius: 6px; border: 1px solid var(--border);
            display: flex; align-items: center; justify-content: center;
            color: var(--text-sub); background: white; transition: all 0.2s;
        }
        .icon-btn:hover { border-color: var(--primary); color: var(--primary); }
        .icon-btn.delete:hover { border-color: var(--danger); color: var(--danger); }

        .empty-view { padding: 60px; text-align: center; color: var(--text-muted); }

        /* =================================================================
           4. å¼¹çª—æ ·å¼ (Modal)
           ================================================================= */
        .modal-mask {
            position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(2px);
            z-index: 1000; display: flex; align-items: center; justify-content: center;
            opacity: 0; visibility: hidden; transition: all 0.3s;
        }
        .modal-mask.active { opacity: 1; visibility: visible; }
        
        .modal-box {
            background: var(--bg-card); width: 650px; max-width: 90%; max-height: 90vh;
            border-radius: 16px; display: flex; flex-direction: column;
            transform: translateY(20px); transition: transform 0.3s;
        }
        .modal-mask.active .modal-box { transform: translateY(0); }

        .modal-head { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .modal-head h3 { font-size: 1.25rem; font-weight: 700; }
        .close-btn { font-size: 1.5rem; color: var(--text-muted); background: none; border: none; cursor: pointer; }
        
        .modal-body { padding: 24px; overflow-y: auto; flex: 1; }
        .modal-foot { padding: 16px 24px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 12px; }

        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .form-span { grid-column: span 2; }
        .form-group label { display: block; font-size: 0.9rem; font-weight: 600; margin-bottom: 8px; color: var(--text-main); }
        .form-input {
            width: 100%; padding: 10px 12px; border: 2px solid var(--border);
            border-radius: 8px; background: var(--bg-body); color: var(--text-main);
            transition: border-color 0.2s;
        }
        .form-input:focus { border-color: var(--primary); }

        /* æ–‡ä»¶ä¸Šä¼  */
        .upload-area {
            border: 2px dashed var(--border); border-radius: 12px; padding: 24px;
            text-align: center; cursor: pointer; transition: all 0.2s;
        }
        .upload-area:hover { border-color: var(--primary); background: var(--bg-active); }
        .file-status {
            margin-top: 10px; padding: 10px; background: var(--primary-light);
            border-radius: 8px; display: flex; justify-content: space-between; align-items: center;
            color: var(--primary); font-size: 0.9rem;
        }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .sidebar { position: fixed; transform: translateX(-100%); box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
            .sidebar.open { transform: translateX(0); }
            .mobile-menu-btn { display: block !important; position: fixed; bottom: 20px; right: 20px; z-index: 1100; width: 50px; height: 50px; border-radius: 50%; background: var(--primary); color: white; border: none; box-shadow: var(--shadow-lg); font-size: 1.5rem; }
            .main-content { padding: 16px; margin-left: 0; }
            .form-grid { grid-template-columns: 1fr; }
            .form-span { grid-column: span 1; }
            .row-meta { display: none; } /* ç§»åŠ¨ç«¯éšè—éƒ¨åˆ†å…ƒæ•°æ® */
            .top-bar { padding: 0 16px; }
            .search-input { width: 150px; }
        }
    </style>
</head>
<body>

<button class="mobile-menu-btn" style="display:none;" onclick="toggleSidebar()">â˜°</button>

<div class="app-container">
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="app-logo">ğŸ”¬</div>
            <span class="app-title">ç§‘ç ”æˆæœç®¡ç†</span>
        </div>

        <nav class="nav-container">
            <div class="nav-group">
                <div class="nav-label">æˆæœåº“</div>
                <div class="nav-item active" onclick="switchView('all')" id="nav-all">
                    <div class="nav-icon">ğŸ“‹</div><span>å…¨éƒ¨æˆæœ</span>
                    <span class="nav-count" id="count-all">0</span>
                </div>
                <div class="nav-item" onclick="switchView('paper')" id="nav-paper">
                    <div class="nav-icon">ğŸ“„</div><span>å­¦æœ¯è®ºæ–‡</span>
                    <span class="nav-count" id="count-paper">0</span>
                </div>
                <div class="nav-item" onclick="switchView('patent')" id="nav-patent">
                    <div class="nav-icon">ğŸ’¡</div><span>å‘æ˜ä¸“åˆ©</span>
                    <span class="nav-count" id="count-patent">0</span>
                </div>
                <div class="nav-item" onclick="switchView('project')" id="nav-project">
                    <div class="nav-icon">ğŸ“Š</div><span>ç§‘ç ”é¡¹ç›®</span>
                    <span class="nav-count" id="count-project">0</span>
                </div>
                <div class="nav-item" onclick="switchView('award')" id="nav-award">
                    <div class="nav-icon">ğŸ†</div><span>è·å¥–æƒ…å†µ</span>
                    <span class="nav-count" id="count-award">0</span>
                </div>
                <div class="nav-item" onclick="switchView('book')" id="nav-book">
                    <div class="nav-icon">ğŸ“š</div><span>ä¸“è‘—å‡ºç‰ˆ</span>
                    <span class="nav-count" id="count-book">0</span>
                </div>
            </div>
            
            <div class="nav-group">
                <div class="nav-label">äººå‘˜</div>
                <div class="nav-item" onclick="switchView('member')" id="nav-member">
                    <div class="nav-icon">ğŸ‘¥</div><span>æˆå‘˜ä¿¡æ¯</span>
                    <span class="nav-count" id="count-member">0</span>
                </div>
            </div>
        </nav>

        <div class="sidebar-footer">
            <div class="storage-indicator" id="dbStatus">
                <div class="indicator-dot"></div>
                <span>æ•°æ®å®‰å…¨ (IndexedDB)</span>
            </div>
            
            <div class="action-buttons">
                <button class="btn-sidebar" style="grid-column:span 2;background:var(--primary);color:white;border:none;" onclick="toggleMenu('exportMenu')">ğŸ“¤ å¯¼å‡º / å¤‡ä»½</button>
                <button class="btn-sidebar" style="grid-column:span 2;" onclick="toggleMenu('importMenu')">ğŸ“¥ å¯¼å…¥ / æ¢å¤</button>
            </div>

            <div id="exportMenu" class="popup-menu">
                <div class="menu-option" onclick="exportToExcel()">ğŸ“Š å¯¼å‡º Excel (åˆ†è¡¨åˆ†åˆ—)</div>
                <div class="menu-option" onclick="exportToWord()">ğŸ“ å¯¼å‡º Word (è¯¦ç»†è¡¨æ ¼)</div>
                <div class="menu-option" onclick="backupJSON()">ğŸ“¦ å¤‡ä»½æ•°æ® (JSON)</div>
            </div>

            <div id="importMenu" class="popup-menu">
                <div class="menu-option" onclick="document.getElementById('file-excel').click()">ğŸ“Š å¯¼å…¥ Excel</div>
                <div class="menu-option" onclick="document.getElementById('file-json').click()">ğŸ“‚ æ¢å¤å¤‡ä»½ (JSON)</div>
            </div>
            
            <input type="file" id="file-json" hidden accept=".json" onchange="restoreJSON(this)">
            <input type="file" id="file-excel" hidden accept=".xlsx,.xls" onchange="importExcel(this)">
        </div>
    </aside>

    <main class="main-wrapper">
        <header class="top-bar">
            <div class="page-title">
                <h1 id="pageTitle">å…¨éƒ¨æˆæœ</h1>
            </div>
            <div class="top-actions">
                <div class="search-wrap">
                    <span class="search-icon">ğŸ”</span>
                    <input type="text" class="search-input" placeholder="æœç´¢æ ‡é¢˜ã€ä½œè€…ã€ç¼–å·..." oninput="handleSearch(this.value)">
                </div>
                <button class="btn-primary" onclick="openAddModal()">
                    <span>â•</span> <span id="addBtnText">æ–°å¢æˆæœ</span>
                </button>
            </div>
        </header>

        <div class="content-scroll">
            <div class="stats-row" id="statsRow">
                </div>

            <div class="list-panel">
                <div class="list-toolbar">
                    <div class="batch-ops">
                        <input type="checkbox" id="selectAll" class="row-check" onchange="toggleSelectAll()">
                        <span id="resultCount">å…± 0 æ¡è®°å½•</span>
                        <button class="btn-danger" id="batchDelBtn" onclick="batchDelete()">åˆ é™¤é€‰ä¸­</button>
                    </div>
                    <div>
                        <select class="form-input" style="padding:6px;width:auto;" onchange="handleSort(this.value)">
                            <option value="date-desc">æ—¥æœŸæœ€æ–°</option>
                            <option value="date-asc">æ—¥æœŸæœ€æ—©</option>
                        </select>
                    </div>
                </div>
                <div class="list-body" id="listContainer">
                    </div>
            </div>
        </div>
    </main>
</div>

<div class="modal-mask" id="editModal">
    <div class="modal-box">
        <div class="modal-head">
            <h3 id="modalTitle">æ–°å¢è®°å½•</h3>
            <button class="close-btn" onclick="closeModal()">Ã—</button>
        </div>
        <div class="modal-body">
            <form id="dataForm" onsubmit="handleFormSubmit(event)">
                <input type="hidden" id="editId">
                <div class="form-grid">
                    <div class="form-group form-span">
                        <label>ç±»å‹</label>
                        <select id="inputType" class="form-input" onchange="updateFormFields()">
                            <option value="paper">å­¦æœ¯è®ºæ–‡</option>
                            <option value="patent">å‘æ˜ä¸“åˆ©</option>
                            <option value="project">ç§‘ç ”é¡¹ç›®</option>
                            <option value="award">è·å¥–æƒ…å†µ</option>
                            <option value="book">ä¸“è‘—å‡ºç‰ˆ</option>
                            <option value="member">æˆå‘˜ä¿¡æ¯</option>
                        </select>
                    </div>

                    <div class="form-group form-span"><label id="lblTitle">æ ‡é¢˜/åç§°</label><input type="text" id="inputTitle" class="form-input" required></div>
                    
                    <div class="form-group" id="grpDate"><label id="lblDate">æ—¥æœŸ</label><input type="date" id="inputDate" class="form-input" required></div>
                    <div class="form-group" id="grpAuthor"><label id="lblAuthor">ä½œè€…/è´Ÿè´£äºº</label><input type="text" id="inputAuthor" class="form-input"></div>
                    
                    <div class="form-group" id="grpSource"><label id="lblSource">æ¥æº/å•ä½</label><input type="text" id="inputSource" class="form-input"></div>
                    <div class="form-group" id="grpLevel"><label id="lblLevel">çº§åˆ«/çŠ¶æ€</label><input type="text" id="inputLevel" class="form-input"></div>

                    <div class="form-group hidden" id="grpCode"><label>ç¼–å·/ä¸“åˆ©å·</label><input type="text" id="inputCode" class="form-input"></div>
                    <div class="form-group hidden" id="grpEndDate"><label>ç»“æŸæ—¶é—´</label><input type="date" id="inputEndDate" class="form-input"></div>
                    <div class="form-group hidden" id="grpExtra1"><label>ä¸“åˆ©ç±»å‹</label><select id="inputExtra1" class="form-input"><option>å‘æ˜ä¸“åˆ©</option><option>å®ç”¨æ–°å‹</option></select></div>
                    <div class="form-group hidden" id="grpExtra2"><label>æˆæƒå…¬å‘Šæ—¥</label><input type="date" id="inputExtra2" class="form-input"></div>

                    <div class="form-group hidden" id="grpMemNo"><label>å·¥å·/å­¦å·</label><input type="text" id="inputMemNo" class="form-input"></div>
                    <div class="form-group hidden" id="grpMemTitle"><label>èŒç§°/å­¦ä½</label><input type="text" id="inputMemTitle" class="form-input"></div>
                    <div class="form-group hidden" id="grpMemPhone"><label>æ‰‹æœº</label><input type="text" id="inputMemPhone" class="form-input"></div>
                    <div class="form-group hidden" id="grpMemEmail"><label>é‚®ç®±</label><input type="text" id="inputMemEmail" class="form-input"></div>
                    
                    <div class="form-group form-span" id="grpKeywords"><label>å…³é”®è¯</label><input type="text" id="inputKeywords" class="form-input"></div>

                    <div class="form-group form-span" id="grpFile">
                        <label>é™„ä»¶ (PDF)</label>
                        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                            <span style="font-size:1.5rem">ğŸ“„</span>
                            <p style="margin-top:5px;color:var(--text-sub);">ç‚¹å‡»ä¸Šä¼ æ–‡ä»¶ (æ”¯æŒå¤§æ–‡ä»¶)</p>
                            <input type="file" id="fileInput" hidden accept=".pdf" onchange="handleFileChange(this)">
                        </div>
                        <div id="fileStatus" class="file-status hidden">
                            <span id="fileName"></span>
                            <button type="button" onclick="clearFile()" style="background:none;border:none;color:var(--danger);cursor:pointer;">åˆ é™¤</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-foot">
            <button class="btn-sidebar" onclick="closeModal()">å–æ¶ˆ</button>
            <button class="btn-primary" onclick="document.getElementById('dataForm').dispatchEvent(new Event('submit'))">ä¿å­˜</button>
        </div>
    </div>
</div>

<script>
/**
 * =================================================================
 * æ ¸å¿ƒé€»è¾‘ (Core Logic) - IndexedDB + å®Œæ•´åŠŸèƒ½
 * =================================================================
 */

// 1. æ•°æ®é…ç½®
const APP = {
    dbName: 'ResearchDB_Pro',
    dbVersion: 1,
    db: null,
    data: { achievements: [], members: [] },
    view: 'all',
    search: '',
    sort: 'date-desc',
    selected: new Set(),
    currentFile: null,
    types: {
        paper: { label: 'å­¦æœ¯è®ºæ–‡', icon: 'ğŸ“„', color: 'type-paper' },
        patent: { label: 'å‘æ˜ä¸“åˆ©', icon: 'ğŸ’¡', color: 'type-patent' },
        project: { label: 'ç§‘ç ”é¡¹ç›®', icon: 'ğŸ“Š', color: 'type-project' },
        award: { label: 'è·å¥–æƒ…å†µ', icon: 'ğŸ†', color: 'type-award' },
        book: { label: 'ä¸“è‘—å‡ºç‰ˆ', icon: 'ğŸ“š', color: 'type-book' },
        member: { label: 'æˆå‘˜', icon: 'ğŸ‘¤', color: 'type-member' }
    }
};

// 2. åˆå§‹åŒ– IndexedDB
function initDB() {
    return new Promise((resolve, reject) => {
        const req = indexedDB.open(APP.dbName, APP.dbVersion);
        req.onupgradeneeded = e => {
            const db = e.target.result;
            if (!db.objectStoreNames.contains('store')) db.createObjectStore('store', { keyPath: 'id' });
        };
        req.onsuccess = e => { APP.db = e.target.result; resolve(); };
        req.onerror = e => reject(e);
    });
}

async function loadData() {
    if (!APP.db) await initDB();
    const tx = APP.db.transaction('store', 'readonly');
    const store = tx.objectStore('store');
    const req = store.get('main_data');
    req.onsuccess = e => {
        if (e.target.result) {
            APP.data = e.target.result.data;
        } else {
            // é¦–æ¬¡è¿è¡Œæˆ–ç©ºåº“
            APP.data = { achievements: [], members: [] };
        }
        updateUI();
    };
}

async function saveData() {
    const tx = APP.db.transaction('store', 'readwrite');
    tx.objectStore('store').put({ id: 'main_data', data: APP.data, updated: new Date() });
    tx.oncomplete = () => {
        // æ›´æ–° UI æç¤º
        const dot = document.querySelector('.indicator-dot');
        dot.style.boxShadow = '0 0 8px var(--success)';
        setTimeout(() => dot.style.boxShadow = 'none', 500);
    };
}

// 3. UI æ¸²æŸ“ä¸äº¤äº’
function updateUI() {
    renderStats();
    renderList();
    updateCounts();
}

function updateCounts() {
    const counts = { paper:0, patent:0, project:0, award:0, book:0 };
    APP.data.achievements.forEach(i => { if(counts[i.type]!==undefined) counts[i.type]++; });
    document.getElementById('count-all').innerText = APP.data.achievements.length;
    document.getElementById('count-member').innerText = APP.data.members.length;
    Object.keys(counts).forEach(k => document.getElementById(`count-${k}`).innerText = counts[k]);
}

function renderStats() {
    const statsDiv = document.getElementById('statsRow');
    const counts = { paper:0, patent:0, project:0, award:0, book:0, member: APP.data.members.length };
    APP.data.achievements.forEach(i => { if(counts[i.type]!==undefined) counts[i.type]++; });
    
    statsDiv.innerHTML = Object.keys(APP.types).map(k => `
        <div class="stat-box">
            <div class="stat-icon ${APP.types[k].color}">${APP.types[k].icon}</div>
            <div class="stat-info"><h3>${counts[k]}</h3><p>${APP.types[k].label}</p></div>
        </div>
    `).join('');
}

function renderList() {
    const listDiv = document.getElementById('listContainer');
    let list = APP.view === 'member' ? APP.data.members : APP.data.achievements;
    
    // Filter View
    if (APP.view !== 'all' && APP.view !== 'member') {
        list = list.filter(i => i.type === APP.view);
    }
    
    // Filter Search
    if (APP.search) {
        const q = APP.search.toLowerCase();
        list = list.filter(i => Object.values(i).join(' ').toLowerCase().includes(q));
    }

    // Sort
    list.sort((a,b) => {
        const da = a.date || '0', db = b.date || '0';
        return APP.sort === 'date-desc' ? (da<db?1:-1) : (da>db?1:-1);
    });

    document.getElementById('resultCount').innerText = `å…± ${list.length} æ¡`;

    if (list.length === 0) {
        listDiv.innerHTML = `<div class="empty-view">æš‚æ— æ•°æ®</div>`;
        return;
    }

    listDiv.innerHTML = list.map(item => {
        const typeConf = APP.types[item.type || 'paper'];
        const title = item.title || item.name;
        const date = item.date || item.birth || '-';
        const sub = item.author || item.org || '-';
        const hasFile = !!item.pdfData;
        const isSel = APP.selected.has(item.id);
        const tag = item.code || item.level || item.status || '';

        return `
            <div class="list-row" onclick="editItem('${item.id}')">
                <input type="checkbox" class="row-check" ${isSel?'checked':''} onclick="toggleSelect('${item.id}', event)">
                <div class="row-icon ${typeConf.color}">${typeConf.icon}</div>
                <div class="row-content">
                    <div class="row-title">${title}</div>
                    <div class="row-meta">
                        <div class="meta-tag">ğŸ“… ${date}</div>
                        <div class="meta-badge">ğŸ‘¤ ${sub}</div>
                        ${tag ? `<div class="meta-badge" style="color:var(--primary)">ğŸ·ï¸ ${tag}</div>` : ''}
                        ${hasFile ? `<div class="meta-tag has-file">ğŸ“ é™„ä»¶</div>` : ''}
                    </div>
                </div>
                <div class="row-actions">
                    ${hasFile ? `<button class="icon-btn" onclick="event.stopPropagation();downloadFile('${item.id}')">â¬‡</button>` : ''}
                    <button class="icon-btn" onclick="event.stopPropagation();editItem('${item.id}')">âœ</button>
                    <button class="icon-btn delete" onclick="event.stopPropagation();deleteItem('${item.id}')">ğŸ—‘</button>
                </div>
            </div>
        `;
    }).join('');
}

// 4. æ“ä½œé€»è¾‘
function switchView(v) {
    APP.view = v; APP.search = ''; APP.selected.clear();
    document.querySelectorAll('.nav-item').forEach(el => el.classList.toggle('active', el.id === `nav-${v}`));
    
    // UI Update
    document.getElementById('addBtnText').innerText = v === 'member' ? 'æ·»åŠ æˆå‘˜' : 'æ·»åŠ æˆæœ';
    document.getElementById('pageTitle').innerText = APP.types[v]?.label || 'å…¨éƒ¨æˆæœ';
    if(window.innerWidth <= 768) toggleSidebar();
    
    renderList();
    document.getElementById('batchDelBtn').style.display = 'none';
    document.getElementById('selectAll').checked = false;
}

function handleSearch(val) { APP.search = val; renderList(); }
function handleSort(val) { APP.sort = val; renderList(); }
function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
function toggleMenu(id) { document.getElementById(id).classList.toggle('show'); }
// Close menu when clicking outside
window.onclick = e => {
    if (!e.target.closest('.data-actions') && !e.target.closest('.popup-menu')) {
        document.querySelectorAll('.popup-menu').forEach(m => m.classList.remove('show'));
    }
};

// 5. CRUD è¡¨å•
function openAddModal() {
    document.getElementById('dataForm').reset();
    document.getElementById('editId').value = '';
    APP.currentFile = null;
    document.getElementById('fileStatus').classList.add('hidden');
    document.getElementById('modalTitle').innerText = 'æ–°å¢è®°å½•';
    
    // Set default type
    const defaultType = (APP.view !== 'all' && APP.view !== 'member') ? APP.view : (APP.view === 'member' ? 'member' : 'paper');
    document.getElementById('inputType').value = defaultType;
    document.getElementById('inputDate').valueAsDate = new Date();
    
    updateFormFields();
    document.getElementById('editModal').classList.add('active');
}

function closeModal() { document.getElementById('editModal').classList.remove('active'); }

function updateFormFields() {
    const type = document.getElementById('inputType').value;
    const isMem = type === 'member';
    const show = id => document.getElementById(id).classList.remove('hidden');
    const hide = id => document.getElementById(id).classList.add('hidden');

    // Reset visibility
    ['grpDate','grpLevel','grpCode','grpEndDate','grpExtra1','grpExtra2','grpMemNo','grpMemTitle','grpMemPhone','grpMemEmail','grpKeywords','grpFile','grpAuthor','grpSource'].forEach(hide);

    if (isMem) {
        show('grpMemNo'); show('grpMemTitle'); show('grpMemPhone'); show('grpMemEmail'); show('grpSource'); show('grpDate');
        document.getElementById('lblTitle').innerText = 'å§“å';
        document.getElementById('lblSource').innerText = 'æ‰€å±å•ä½';
        document.getElementById('lblDate').innerText = 'å‡ºç”Ÿå¹´æœˆ';
    } else {
        show('grpDate'); show('grpAuthor'); show('grpSource'); show('grpLevel'); show('grpKeywords'); show('grpFile');
        document.getElementById('lblTitle').innerText = 'æ ‡é¢˜/åç§°';
        document.getElementById('lblDate').innerText = 'æ—¥æœŸ';
        document.getElementById('lblAuthor').innerText = 'ä½œè€…/è´Ÿè´£äºº';
        document.getElementById('lblSource').innerText = 'æœŸåˆŠ/æ¥æº/å•ä½';
        document.getElementById('lblLevel').innerText = 'çº§åˆ«/çŠ¶æ€';

        if(type === 'patent') { show('grpCode'); show('grpExtra1'); show('grpExtra2'); document.getElementById('lblLevel').innerText='çŠ¶æ€'; }
        if(type === 'project') { show('grpCode'); show('grpEndDate'); document.getElementById('lblLevel').innerText='çº§åˆ«'; }
    }
}

function handleFileChange(input) {
    const file = input.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = e => {
        APP.currentFile = { name: file.name, data: e.target.result };
        document.getElementById('fileName').innerText = file.name;
        document.getElementById('fileStatus').classList.remove('hidden');
    };
    reader.readAsDataURL(file);
}

function clearFile() { APP.currentFile = null; document.getElementById('fileInput').value=''; document.getElementById('fileStatus').classList.add('hidden'); }

function handleFormSubmit(e) {
    e.preventDefault();
    const id = document.getElementById('editId').value;
    const type = document.getElementById('inputType').value;
    const isMem = type === 'member';

    const newItem = {
        id: id || Date.now().toString(),
        type: type,
        updatedAt: new Date().toISOString()
    };

    if (isMem) {
        newItem.name = document.getElementById('inputTitle').value;
        newItem.birth = document.getElementById('inputDate').value;
        newItem.org = document.getElementById('inputSource').value;
        newItem.no = document.getElementById('inputMemNo').value;
        newItem.title = document.getElementById('inputMemTitle').value;
        newItem.phone = document.getElementById('inputMemPhone').value;
        newItem.email = document.getElementById('inputMemEmail').value;
        
        // Save to Members
        if(id) {
            const idx = APP.data.members.findIndex(m=>m.id===id);
            if(idx>-1) APP.data.members[idx] = newItem;
        } else APP.data.members.push(newItem);

    } else {
        newItem.title = document.getElementById('inputTitle').value;
        newItem.date = document.getElementById('inputDate').value;
        newItem.author = document.getElementById('inputAuthor').value;
        newItem.source = document.getElementById('inputSource').value;
        newItem.level = document.getElementById('inputLevel').value;
        newItem.keywords = document.getElementById('inputKeywords').value;
        newItem.code = document.getElementById('inputCode').value; // Patent/Project No
        
        // Specific fields
        if(type==='project') newItem.endDate = document.getElementById('inputEndDate').value;
        if(type==='patent') {
            newItem.patentType = document.getElementById('inputExtra1').value;
            newItem.grantDate = document.getElementById('inputExtra2').value;
        }

        // File
        if(APP.currentFile) {
            newItem.pdfData = APP.currentFile.data;
            newItem.pdfName = APP.currentFile.name;
        } else if(id) {
            // Keep old file
            const old = APP.data.achievements.find(i=>i.id===id);
            if(old && old.pdfData) { newItem.pdfData = old.pdfData; newItem.pdfName = old.pdfName; }
        }

        // Save to Achievements
        if(id) {
            const idx = APP.data.achievements.findIndex(i=>i.id===id);
            if(idx>-1) APP.data.achievements[idx] = newItem;
        } else APP.data.achievements.push(newItem);
    }

    saveData();
    closeModal();
    updateUI();
}

function editItem(id) {
    const isMem = APP.data.members.find(m => m.id === id);
    const item = isMem || APP.data.achievements.find(i => i.id === id);
    if(!item) return;

    openAddModal();
    document.getElementById('modalTitle').innerText = 'ç¼–è¾‘è®°å½•';
    document.getElementById('editId').value = id;
    document.getElementById('inputType').value = item.type;
    updateFormFields();

    // Fill Data
    document.getElementById('inputTitle').value = item.title || item.name;
    document.getElementById('inputDate').value = item.date || item.birth;
    document.getElementById('inputSource').value = item.source || item.org;
    
    if(isMem) {
        document.getElementById('inputMemNo').value = item.no;
        document.getElementById('inputMemTitle').value = item.title;
        document.getElementById('inputMemPhone').value = item.phone;
        document.getElementById('inputMemEmail').value = item.email;
    } else {
        document.getElementById('inputAuthor').value = item.author;
        document.getElementById('inputLevel').value = item.level;
        document.getElementById('inputKeywords').value = item.keywords;
        document.getElementById('inputCode').value = item.code || '';
        if(item.endDate) document.getElementById('inputEndDate').value = item.endDate;
        if(item.patentType) document.getElementById('inputExtra1').value = item.patentType;
        if(item.grantDate) document.getElementById('inputExtra2').value = item.grantDate;
        
        if(item.pdfData) {
            document.getElementById('fileName').innerText = item.pdfName;
            document.getElementById('fileStatus').classList.remove('hidden');
        }
    }
}

// 6. æ‰¹é‡æ“ä½œ
function toggleSelectAll() {
    const all = document.getElementById('selectAll').checked;
    const boxes = document.querySelectorAll('.row-check');
    boxes.forEach(b => {
        b.checked = all;
        const id = b.parentElement.getAttribute('onclick').match(/'(.*?)'/)[1];
        if(all) APP.selected.add(id); else APP.selected.delete(id);
    });
    updateBatchBtn();
}

function toggleSelect(id, e) {
    e.stopPropagation();
    if(APP.selected.has(id)) APP.selected.delete(id); else APP.selected.add(id);
    updateBatchBtn();
}

function updateBatchBtn() {
    document.getElementById('batchDelBtn').style.display = APP.selected.size > 0 ? 'block' : 'none';
}

function batchDelete() {
    if(!confirm(`ç¡®å®šåˆ é™¤é€‰ä¸­çš„ ${APP.selected.size} æ¡è®°å½•å—ï¼Ÿ`)) return;
    
    if(APP.view === 'member') {
        APP.data.members = APP.data.members.filter(m => !APP.selected.has(m.id));
    } else {
        APP.data.achievements = APP.data.achievements.filter(i => !APP.selected.has(i.id));
    }
    
    APP.selected.clear();
    saveData();
    updateUI();
}

function deleteItem(id) {
    if(!confirm('ç¡®å®šåˆ é™¤æ­¤è®°å½•ï¼Ÿ')) return;
    APP.data.members = APP.data.members.filter(m => m.id !== id);
    APP.data.achievements = APP.data.achievements.filter(i => i.id !== id);
    saveData();
    updateUI();
}

// 7. æ–‡ä»¶ä¸‹è½½
function downloadFile(id) {
    const item = APP.data.achievements.find(i => i.id === id);
    if(item && item.pdfData) {
        // Base64 to Blob
        const arr = item.pdfData.split(',');
        const bstr = atob(arr[1]);
        let n = bstr.length; const u8arr = new Uint8Array(n);
        while(n--) u8arr[n] = bstr.charCodeAt(n);
        const blob = new Blob([u8arr], {type: 'application/pdf'});
        
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = item.pdfName;
        a.click();
    }
}

// 8. å¯¼å…¥å¯¼å‡ºé€»è¾‘ (Import/Export)
function backupJSON() {
    const str = JSON.stringify(APP.data);
    const blob = new Blob([str], {type: "application/json"});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `research_backup_${new Date().toISOString().slice(0,10)}.json`;
    a.click();
}

function restoreJSON(input) {
    const file = input.files[0];
    if(!file) return;
    const r = new FileReader();
    r.onload = e => {
        try {
            const d = JSON.parse(e.target.result);
            if(d.achievements || d.members) {
                if(confirm('æ¢å¤å°†è¦†ç›–å½“å‰æ•°æ®ï¼Œç¡®å®šå—ï¼Ÿ')) {
                    APP.data = d;
                    saveData();
                    updateUI();
                    alert('æ¢å¤æˆåŠŸ');
                }
            }
        } catch(err) { alert('æ–‡ä»¶æ ¼å¼é”™è¯¯'); }
    };
    r.readAsText(file);
    input.value = '';
}

// === åˆ†è¡¨åˆ†åˆ— Excel å¯¼å‡º ===
function exportToExcel() {
    const wb = XLSX.utils.book_new();

    // Helper: Add Sheet
    const addSheet = (name, data) => {
        if(data.length > 0) {
            const ws = XLSX.utils.json_to_sheet(data);
            XLSX.utils.book_append_sheet(wb, ws, name);
        }
    };

    // 1. å­¦æœ¯è®ºæ–‡
    addSheet("å­¦æœ¯è®ºæ–‡", APP.data.achievements.filter(i=>i.type==='paper').map(i=>({
        'æ ‡é¢˜': i.title, 'ä½œè€…': i.author, 'æ—¥æœŸ': i.date, 'æœŸåˆŠ': i.source, 'çº§åˆ«': i.level, 'å…³é”®è¯': i.keywords
    })));

    // 2. å‘æ˜ä¸“åˆ©
    addSheet("å‘æ˜ä¸“åˆ©", APP.data.achievements.filter(i=>i.type==='patent').map(i=>({
        'ä¸“åˆ©åç§°': i.title, 'ç±»å‹': i.patentType, 'å‘æ˜äºº': i.author, 'æƒåˆ©äºº': i.source, 
        'ç”³è¯·æ—¥': i.date, 'æˆæƒæ—¥': i.grantDate, 'ä¸“åˆ©å·': i.code, 'çŠ¶æ€': i.level
    })));

    // 3. ç§‘ç ”é¡¹ç›®
    addSheet("ç§‘ç ”é¡¹ç›®", APP.data.achievements.filter(i=>i.type==='project').map(i=>({
        'é¡¹ç›®åç§°': i.title, 'ç¼–å·': i.code, 'çº§åˆ«': i.level, 'è´Ÿè´£äºº': i.author, 
        'å•ä½': i.source, 'å¼€å§‹æ—¶é—´': i.date, 'ç»“æŸæ—¶é—´': i.endDate
    })));

    // 4. è·å¥–
    addSheet("è·å¥–æƒ…å†µ", APP.data.achievements.filter(i=>i.type==='award').map(i=>({
        'å¥–é¡¹åç§°': i.title, 'è·å¥–äºº': i.author, 'æ—¥æœŸ': i.date, 'çº§åˆ«': i.level
    })));

    // 5. è‘—ä½œ
    addSheet("ä¸“è‘—å‡ºç‰ˆ", APP.data.achievements.filter(i=>i.type==='book').map(i=>({
        'ä¹¦å': i.title, 'ä½œè€…': i.author, 'å‡ºç‰ˆæ—¥æœŸ': i.date, 'å‡ºç‰ˆç¤¾': i.source
    })));

    // 6. æˆå‘˜
    addSheet("æˆå‘˜ä¿¡æ¯", APP.data.members.map(m=>({
        'å·¥å·': m.no, 'å§“å': m.name, 'æ€§åˆ«': m.gender, 'å‡ºç”Ÿå¹´æœˆ': m.birth, 
        'èŒç§°': m.title, 'å•ä½': m.org, 'æ‰‹æœº': m.phone, 'é‚®ç®±': m.email
    })));

    if(wb.SheetNames.length === 0) return alert('æ— æ•°æ®å¯å¯¼å‡º');
    XLSX.writeFile(wb, "ç§‘ç ”æˆæœåˆ†è¡¨å¯¼å‡º.xlsx");
}

function importExcel(input) {
    const file = input.files[0];
    if(!file) return;
    const r = new FileReader();
    r.onload = e => {
        const d = new Uint8Array(e.target.result);
        const wb = XLSX.read(d, {type:'array'});
        // Simple import logic (assumes 1st sheet is papers for now, or ask user)
        // For simplicity in this robust version, we import to 'paper' default
        const ws = wb.Sheets[wb.SheetNames[0]];
        const json = XLSX.utils.sheet_to_json(ws);
        let count = 0;
        json.forEach(row => {
            APP.data.achievements.push({
                id: Date.now() + Math.random().toString(),
                type: 'paper',
                title: row['æ ‡é¢˜'] || row['Title'] || 'å¯¼å…¥æ•°æ®',
                date: row['æ—¥æœŸ'] || new Date().toISOString().slice(0,10),
                author: row['ä½œè€…'] || '',
                source: row['æœŸåˆŠ'] || '',
                level: row['çº§åˆ«'] || '',
                updatedAt: new Date().toISOString()
            });
            count++;
        });
        saveData();
        updateUI();
        alert(`æˆåŠŸå¯¼å…¥ ${count} æ¡æ•°æ®`);
    };
    r.readAsArrayBuffer(file);
    input.value = '';
}

// === åˆ†è¡¨ Word å¯¼å‡º ===
function exportToWord() {
    let html = `<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word'><head><meta charset='utf-8'><style>table{width:100%;border-collapse:collapse;margin-bottom:20px;font-size:10pt}th,td{border:1px solid #000;padding:5px;text-align:center}th{background:#eee}</style></head><body><h2>ç§‘ç ”æ±‡æ€»è¡¨</h2>`;
    
    const groups = {
        'å­¦æœ¯è®ºæ–‡': APP.data.achievements.filter(i=>i.type==='paper'),
        'å‘æ˜ä¸“åˆ©': APP.data.achievements.filter(i=>i.type==='patent'),
        'ç§‘ç ”é¡¹ç›®': APP.data.achievements.filter(i=>i.type==='project'),
        'è·å¥–æƒ…å†µ': APP.data.achievements.filter(i=>i.type==='award'),
        'ä¸“è‘—å‡ºç‰ˆ': APP.data.achievements.filter(i=>i.type==='book'),
        'æˆå‘˜ä¿¡æ¯': APP.data.members
    };

    for(let name in groups) {
        const arr = groups[name];
        if(arr.length === 0) continue;
        html += `<h3>${name}</h3><table><tr>`;
        
        // Headers logic
        if(name==='å­¦æœ¯è®ºæ–‡') html+=`<th>æ ‡é¢˜</th><th>ä½œè€…</th><th>æ—¥æœŸ</th><th>æ¥æº</th><th>çº§åˆ«</th>`;
        else if(name==='å‘æ˜ä¸“åˆ©') html+=`<th>åç§°</th><th>ç±»å‹</th><th>çŠ¶æ€</th><th>ä¸“åˆ©å·</th><th>ç”³è¯·æ—¥</th>`;
        else if(name==='ç§‘ç ”é¡¹ç›®') html+=`<th>åç§°</th><th>ç¼–å·</th><th>çº§åˆ«</th><th>å•ä½</th><th>èµ·æ­¢æ—¶é—´</th>`;
        else if(name==='æˆå‘˜ä¿¡æ¯') html+=`<th>å·¥å·</th><th>å§“å</th><th>èŒç§°</th><th>å•ä½</th><th>æ‰‹æœº</th>`;
        else html+=`<th>åç§°</th><th>äººå‘˜</th><th>æ—¥æœŸ</th><th>å¤‡æ³¨</th>`;
        html += `</tr>`;

        // Rows logic
        arr.forEach(i => {
            html += `<tr>`;
            if(name==='å­¦æœ¯è®ºæ–‡') html+=`<td>${i.title}</td><td>${i.author}</td><td>${i.date}</td><td>${i.source}</td><td>${i.level}</td>`;
            else if(name==='å‘æ˜ä¸“åˆ©') html+=`<td>${i.title}</td><td>${i.patentType||''}</td><td>${i.level||''}</td><td>${i.code||''}</td><td>${i.date}</td>`;
            else if(name==='ç§‘ç ”é¡¹ç›®') html+=`<td>${i.title}</td><td>${i.code||''}</td><td>${i.level||''}</td><td>${i.source||''}</td><td>${i.date} è‡³ ${i.endDate||''}</td>`;
            else if(name==='æˆå‘˜ä¿¡æ¯') html+=`<td>${i.no}</td><td>${i.name}</td><td>${i.title}</td><td>${i.org}</td><td>${i.phone}</td>`;
            else html+=`<td>${i.title}</td><td>${i.author}</td><td>${i.date}</td><td>${i.level||''}</td>`;
            html += `</tr>`;
        });
        html += `</table>`;
    }

    html += `</body></html>`;
    const blob = new Blob([html], {type: 'application/msword'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'ç§‘ç ”æ•°æ®åˆ†è¡¨æ±‡æ€».doc';
    a.click();
}

// Init
window.onload = loadData;

</script>
</body>
</html>
